---
title: "Story Telling Documents"
author: "Borja Sánchez"
date: "19/1/2022"
output: pdf_document
---
# Technical Questions

## 1. Do some descriptive analysis on the data you have.
As we can see, it is a purchase history, in which we have various data related to the purchase, either the date of purchase, from which device it was made, for what amount it was purchased, which operating system was used, even if the purchase was made or not or the browser used, among others.

To start the analysis of the data, we must change the format of the dates, for this I use the package "lubridate", to change the format "dd/mm/yy" of the date "dd/mm/yyyy", to be able to transform it into a date. I also proceed to add a column year, month and day, in order to make a more specific analysis. 

```
data <- transform(
  data,
  date=as.Date(dmy(date), "%m/%d/%Y")
)

#Create year month and day columns
year <- as.numeric(format(data$date,'%Y'))
month <- as.numeric(format(data$date,'%m'))
day <- as.numeric(format(data$date,'%d'))

#Add my new columns to my dataframe
data <- cbind(data, year,month,day)
```
Starting with the status, we observe that a large number of purchases are not finalized (Figure 1). Using the table function of the dplyr package, we also observe that the most used currency is the USD (Figure 2), while the most used device to make purchases is the mobile phone (Figure 3).

![Purchases](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\purchases.png)

As we can see, more than 2000 purchases have not been finished.

![Currency](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\Rplot_currency_plot.png)

While GBP has just 120 occurrences, USD has more than 2600.


![Devices](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\Rplot_devices.png)

```
#Histogram of how many purchases were done, and how many not
hist(data$status, main = "Status of purchases")
#USD is the most used one
count_os <- table(data$currency)
count_os
#Mobile phone is the most used device
count_device <- table(data$device)
count_device
```
Finally, I create a dataset with only the lines in which a purchase has been made, so that I can see that more than half of the purchases were made at a discount (Figure 4).

![Discount](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\capture_discount.png)


```
purchases_with_discount <- data[data$status == 1,]
count_discount <- table(purchases_with_discount$discount)
count_discount
```

## 2. Which variables seem to be highly related with conversion rate?
As I said in the previous question, one of the variables that is most related to the conversion rate is the discount, since we observed that a large number of purchases were made because they had a discount.
Now I proceed to perform an analysis to see if the price paid has to do with whether the purchase was made or not, for this, first I use "gsub", to change the comma by a point and thus be able to transform the column into a numerical type.
```
data$amount <- gsub(",", ".", data$amount)

data <- transform(
  data,
  amount=as.numeric(amount)
)
```
Now, if we do summary(data), we observe that the mean is 23.98. Having figured this out, I proceed to create two datasets, one with price > 23.98 and one with price < 23.98. Using the hist function, we observe that in both cases few purchases are made, but in the case that the price is cheap, approximately 200 more purchases are made, so we could say that the price is related (although this is to be expected).
![Purchases on cheap/expensive products](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\Rplot_purchases_cheap_expensive.png)

Both the product owner and the advert partner have several values, as we observed with the unique function, which makes their analysis more complex.

## 3. Does the discount significantly improve the conversion rate?
Making some calculations, we observe that with the discount there is a 21% of purchases made, while without the discount we have a 28%.
```

data_with_discount <- data[data$discount >0,]
data_without_discount <- data[data$discount == "",]
purchases <- table(data_with_discount$status == 1)
purchases_2 <- table(data_without_discount$status == 1)

conversion_rate_discount <- purchases[2]/nrow(data_with_discount)
nrow(data_with_discount)
conversion_rate_discount*100
conversion_rate_without_discount <- purchases_2[2]/nrow(data_without_discount)
nrow(data_with_discount)
conversion_rate_without_discount*100
```
We must also take into account that there are 2401 lines with discount, and 700 without, which makes me think that 21% of 2401 is much higher than 28% of 700, so we could say that yes, there is a large increase if there is a discount.

Going back to the same thing I did in the previous question, I am going to look at whether the price affects anything when there is a discount. To do this, I will recalculate the average price on the lines that have a discount, and divide it into cheap and expensive.
```
data_cheap_discount <- data_with_discount[data_with_discount$amount <= 8,]
data_expensive_discount <- data_with_discount[data_with_discount$amount > 8,]
par(mfrow = c(2, 1))
hist(data_cheap_discount$status, main = "Purchases with amount <= 8 and discount")
hist(data_expensive_discount$status, main = "Purchases with amount > 8 and discount")
```
![Purchases on cheap/expensive products with discounts](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\Rplot_purchases_discount.png)

We have even observed that more expensive products are purchased simply because of a discount (Figure 5).

## 4.What is the best strategy in terms of advanced analytics to improve conversion rate in relation to discounts? Can you explain it? If it’s possible, can you code your solution?
In terms of advanced analytics, I think we should resort to a classification algorithm, which tells us with some accuracy when something is bought or not. A regression algorithm is not useful in this case, since we are talking about the variable we want to predict is 1 (bought) or 0 (not bought), a regression algorithm would be more useful in case we want to estimate a price (for example).

I think the best option in this case would be to use a random forest.
To develop the model, I will use the packages caTools and caret (the latter to calculate the confusion matrix). To start, I will remove the columns we do not need, among them the date, the merchant_id, the partner_id ,the operating system and the browser, since they are not relevant. 
```
#Elimination of date, merchant_ud and partner_id
data <- subset(data,select =-c(date,merchant_id,partner_id,os,browser))
```
Once we have eliminated the columns that we do not need, I am going to modify the data a little bit to give us more information for the training of the model, to begin with we are going to modify the amount column. As we know from the previous questions, the average amount is 23.98, so I am going to divide the price in two categories, cheap (amount <= 24) or expensive (amount > 24), which will be 0 and 1 respectively.
```
data$amount <- gsub(",", ".", data$amount)
data <- transform(
  data,
  amount=as.numeric(amount)
)
#Data treatment
data$amount[data$amount <= 24.0] <- 0
data$amount[data$amount > 24.0] <- 1
```
We perform the same task for the rest of the columns, converting them into factors. Among them if it has discount (1) or not (0).

```
data$currency[data$currency == "USD"] <- 0
data$currency[data$currency == "EUR"] <- 1
data$currency[data$currency == "GBP"] <- 2

data$device[data$device == "Mobile Phone"] <- 0
data$device[data$device == "Desktop"] <- 1
data$device[data$device == "Mobile Device"] <- 2
data$device[data$device == "Tablet"] <- 3
data$device[data$device == "TV Device"] <- 4
```
We also change the status, as explained in the dictionary.

```
#Converting into factors
data <- mutate(data,amount = factor(amount, levels = c(0, 1), labels = c('Cheap', 'Expensive')),
              currency = factor(currency, levels = c(0, 1,2), labels = c('USD', 'EUR','Expensive')),
              device = factor(device, levels = c(0, 1,2,3,4), labels = c('Mobile Phone', 'Desktop','Mobile Device','Tablet','TV Device')),
              discount = factor(discount, levels = c(0, 1), labels = c('No discount', 'Has Discount')))
data <- mutate(data, status = factor(status, levels = c(0, 1), labels = c('Purchased not completed', 'Purchase done')))

```
Now that we have processed all the data, it is time to create the training set and the test set, and then create the random forest.
```
#Now, we create our model
set.seed(123)
split <- sample.split(data$status, SplitRatio = 0.8) 

#Creating the training set
trainingSet <- subset(data, split == T)
#Creating the test set
testSet <- subset(data,split == F)

#Creation of the random forest
rf <- randomForest(status~.,data=trainingSet)
rf
```
This is the output:

![Random forest.](C:\Users\borja\Desktop\Vendo_Test_Borja_Sanchez\Images\captura_randomforest.PNG)

It can be seen that we have a random forest of 500 trees, in addition to a confusion matrix, in which we observe that we do not have a bad % of success. Finally, we will make predictions and calculate the new confusion matrix:
```
#Prediction
pred <- predict(rf,testSet)
pred

#Confusion matrix
confusionMatrix <- confusionMatrix(pred,testSet$status)
confusionMatrix

```
![Confusion Matrix.](C:\Users\borja\Desktop\Curso R\captura_confusionmatrix.PNG)

We observed an accuracy of 78%. This is acceptable, but there is room for improvement.

# Concepts
## 1.In terms of analytics, describe what is an A/B testing and its purpose.
A/B testing consists of generating two models of the same app or web page, to find out which one performs better. These two models can differ very little, even in a header. This methodology is used by several companies to add small changes to their app or website.

## 2.Related with machine learning, describe what is a feature vector. 
A feature vector is a set of features describing an object, which will be used for an algorithm as a representation of this object. They can also be combined with a weight, normally on linear models.

## 3.Explain the main difference between a classification and a regression model.
The main difference between both models is that regression models are made for predicting a value, like the stock, price, age... But classification models predict if the input is on one group or another, for example if it will be spam or not spam.
Mathematically speaking, regression models try to create a function that fits all the dataset, and classification models try to create a function for dividing data.

## 4.Explain how data analytics and big data can help the company to improve performance and increase revenue.
Every company generates data, and this data can be useless if you do not know how to manage it, but if you have people able to do an analysis of it, you can learn from your data, knowing what is going to be better for your company or maybe predicting if something is gonna be worth or not. This simple analysis can suppose a big deal for a company, increasing his revenue.
